<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh Sách Sách</title>
</head>
<body>
<div layout:fragment="content" class="py-4">
    <section class="bookstore-hero mb-5">
        <div class="row g-4 align-items-center">
            <div class="col-lg-7">
                <span class="hero-badge">
                    <i class="fas fa-sparkles"></i> Nhà Sách Chọn Lọc
                </span>
                <h1>Ươm mầm trí tuệ với từng trang sách</h1>
                <p>Khám phá những tựa sách mới nhất, bản đặc biệt và các chủ đề được tuyển chọn dành riêng cho bạn.</p>
                <div class="hero-stats">
                    <div class="hero-stat">
                        <span th:text="${books.size()}">120</span>
                        <small>Đầu sách hiện có</small>
                    </div>
                    <div class="hero-stat">
                        <span>24/7</span>
                        <small>Mua sắm mọi lúc</small>
                    </div>
                    <div class="hero-stat">
                        <span>+50</span>
                        <small>Thể loại phong phú</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-5">
                <div class="glass-card">
                    <form action="/books" method="get" class="search-bar">
                        <label class="form-label text-muted">Tìm kiếm nhanh</label>
                        <div class="input-group mb-3">
                            <input type="text"
                                   name="keyword"
                                   class="form-control"
                                   placeholder="Nhập tên sách, tác giả, chủ đề…"
                                   th:value="${keyword}">
                            <button type="submit">
                                <i class="fas fa-search"></i> Tìm
                            </button>
                        </div>
                    </form>
                    <div class="category-chips">
                        <a href="#" class="category-chip">Tiểu thuyết</a>
                        <a href="#" class="category-chip">Kinh doanh</a>
                        <a href="#" class="category-chip">Thiếu nhi</a>
                        <a href="#" class="category-chip">Self-help</a>
                        <a href="#" class="category-chip">Công nghệ</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div th:if="${books.empty}" class="alert alert-info">
        <i class="fas fa-info-circle"></i> Kho sách hiện chưa có dữ liệu.
    </div>

    <section th:if="${!books.empty}">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <h2 class="mb-0">Danh sách nổi bật</h2>
                <small class="text-muted">Chọn lọc những bản in chất lượng và xu hướng đọc mới nhất.</small>
            </div>
            <span class="badge text-bg-light px-3 py-2">
                <i class="fas fa-layer-group"></i>
                <span th:text="${books.size()}"></span> tựa sách
            </span>
        </div>

        <div class="book-grid">
            <article class="book-card" th:each="book : ${books}" th:id="'book-' + ${book.id}">
                <div class="book-card__cover">
                    <img th:if="${book.imageUrl}" th:src="${book.imageUrl}" alt="Bìa sách">
                    <i th:unless="${book.imageUrl}" class="fas fa-book fa-4x text-muted"></i>
                    <span class="stock-badge" th:if="${book.quantity <= 5}">Sắp hết!</span>
                </div>
                <div class="book-card__body">
                    <div>
                        <h5 class="fw-bold mb-1" th:text="${book.title}">Book Title</h5>
                        <p class="mb-1 text-muted">
                            <i class="fas fa-user"></i>
                            <span th:text="${book.author}">Author</span>
                        </p>
                        <p class="mb-2">
                            <span class="inventory-pill">
                                <i class="fas fa-tag"></i>
                                <span th:text="${book.category}">Category</span>
                            </span>
                        </p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="price-tag">
                                <span th:text="${#numbers.formatDecimal(book.price, 0, 'COMMA', 0, 'POINT')}">0</span> đ
                            </span>
                            <small class="text-muted">
                                Còn <span th:text="${book.quantity}">0</span> cuốn
                            </small>
                        </div>
                        <p class="mt-3 text-muted" th:if="${book.description}">
                            <small th:text="${#strings.abbreviate(book.description, 90)}">Description</small>
                        </p>
                    </div>
                    <div class="actions mt-3">
                        <form th:action="@{/books/cart/add/{id}(id=${book.id})}" method="post">
                            <button type="submit" class="btn btn-success"
                                    th:disabled="${book.quantity <= 0}">
                                <i class="fas fa-cart-plus"></i> Thêm vào giỏ
                            </button>
                        </form>
                        <div class="admin-actions" sec:authorize="hasRole('ADMIN')">
                            <a th:href="@{/books/edit/{id}(id=${book.id})}" class="btn btn-warning flex-fill">
                                <i class="fas fa-edit"></i> Sửa
                            </a>
                            <a th:href="@{/books/delete/{id}(id=${book.id})}" class="btn btn-danger flex-fill"
                               onclick="return confirm('Bạn có chắc muốn xóa sách này?')">
                                <i class="fas fa-trash"></i> Xóa
                            </a>
                        </div>
                    </div>
                </div>
            </article>
        </div>
    </section>
</div>
<div class="toast-notice" th:if="${successMessage}">
    <i class="fas fa-check-circle fa-lg"></i>
    <p class="toast__text mb-0" th:text="${successMessage}">Đã thêm vào giỏ hàng!</p>
    <button type="button" class="btn-close" aria-label="Đóng" onclick="this.parentElement.classList.remove('show')"></button>
</div>
<script th:if="${successMessage}">
    setTimeout(() => {
        const toast = document.querySelector('.toast-notice');
        if (toast) {
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3500);
        }
    }, 150);
</script>
</body>
</html>
